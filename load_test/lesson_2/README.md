# Lesson #2

### Цель занятия (немного перефразировал для себя)
1) Провести нагрузочное тестирование ендпоинта /user/search/{first_name}-{last_name} (обучающего проекта соц. сеть).
Поиграть с количеством одновременных запросов. 1/10/100/1000.
2) Построить графики и сохранить их в отчет
3) Добавить в таблицу подходящий индекс и повторить пункт 2
4) Определить эффективность использования индексов в таблице

### План мерприятий

1) Для оптимизации запроса в режиме подстрочного поиска я подключил расширение 'pg_trgm' (подключаем в psql)
```
SELECT pg_available_extension('pg_trgm');
```
2) В ходе работы был добавлен составной индекс GIN для first_name и last_name.
Такой тип индекса был добавлен потому что он позволяет реализовывать подстрочный поиск в таблице, но поскольку тип колонки first_name и last_name является varchar(N) и шаблон поиска по неточному вхождению LIKE %*%, необходимо подключать поиск по триграммам "pg_trgm"
```
CREATE INDEX idx_users_first_last_name_trgm
ON users USING gin (first_name gin_trgm_ops, last_name gin_trgm_ops);
```
3) Для проверки работы индекса в таблице и углубленного анализа был использован в psql следующий запрос (скриншот EXPLAIN ANALYZE находиться по пути load_test/lesson_2/)
```
EXPLAIN ANALYZE SELECT id, first_name, last_name FROM users WHERE first_name LIKE '%абрам%' AND last_name LIKE '%робе%' ORDER BY id;
```

4) Проведено нагрузочное тестирование с помощью утилиты  'K6' и собрана статистика (до и после добавления индекса) 1/10/100/1000 отдельными графиками для наглядности. Статистика храниться по пути load_test/lesson_2/graphics/

### Результат

После добавления индексов скорость выполнения запроса снизилось с 217ms до 7ms
